<html>
  <head>
    <title>Cheloniidae Live</title>
    <script src='divergence.js'></script>
    <script src='divergence.rebase.js'></script>
    <script src='divergence.debug.js'></script>

    <script>
      d.tracer = console.log.bind (console);
      d.rebase.init = d.debug.trace.compose (d.rebase.init);
    </script>

    <script src='divergence.vector.js'></script>
    <script src='cheloniidae-live.js'></script>
  </head>

  <body style='font-family:sans-serif; font-size: 9pt'>
    <div style='float:right'>
      <strong>Mouse commands</strong>
      <ul>
      <li><em>Drag</em> - move the camera</li>
      <li><em>Shift-drag</em> - rotate the camera</li>
      <li><em>Control-drag</em> - zoom</li>
      </ul>
    </div>

    <canvas id='screen' width='600' height='350' style='border: solid 1px #888'>
      This page requires a browser with HTML5 canvas support. Valid browsers include <a href='http://getfirefox.com'>Mozilla Firefox</a> and <a href='http://google.com/chrome'>Google
      Chrome</a>.
    </canvas>

    <script>
      d.rebase (function () {
        var c  = document.getElementById ('screen');
        var t  = cheloniidae.turtle ({queue: []}).jump (-80);
        var cs = ['.move(160)', '.turn(176.0 .degrees())', '.pitch(0.5 .degrees())'].map('.fn()').repeat (3);
        var v  = new cheloniidae.viewport ({pov: cheloniidae.vector(0, 0, -350), context: c.getContext ('2d'), forward: cheloniidae.vector(0, 0, 1), up: cheloniidae.vector (0, 1, 0),
                                            width: 600, height: 350, batch: 50, delay: 0});
        t = cs.fold ('$1($0)', t);

        c.onmousedown = '@x_down = $0.clientX, @y_down = $0.clientY'.bind (c);
        document.onmousemove = e >$> ((c.x_down || c.y_down) && (e.shiftKey ? v.turn ((c.x_down - (c.x_down = e.clientX)).degrees()).pitch (-(c.y_down - (c.y_down = e.clientY)).degrees()) :
                                                                  e.ctrlKey ? v.zoom  (c.y_down - (c.y_down = e.clientY)) :
                                                                              v.slide (c.x_down - (c.x_down = e.clientX), c.y_down - (c.y_down = e.clientY)),
                                                                 v.context.clearRect (0, 0, v.width, v.height),
                                                                 v.cancel ().render (false)));
        document.onmouseup = e >$> ((c.x_down || c.y_down) && (v.context.clearRect (0, 0, v.width, v.height), v.cancel().render(true)), c.x_down = c.y_down = null);

        v.queue = t.queue;
        v.render();
      }) ();
    </script>
  </body>
</html>
